# 抽屉选择音频功能说明

## ✅ 新功能：点击调式按钮弹出抽屉

### 🎯 功能描述
- **点击未加载的调**: 弹出抽屉，显示项目中可用的音频文件列表
- **点击已加载的调**: 直接切换到该调并加载音频
- **从抽屉选择**: 点击列表中的音频文件即可加载

### 🎨 交互流程

#### 场景1：选择未加载的调
1. **点击按钮**: 点击任意未加载的调（如 C 调，灰色背景）
2. **抽屉弹出**: 从底部滑出抽屉，显示"选择 C 调音频"
3. **查看列表**: 显示项目中所有可用的音频文件
4. **选择音频**: 点击列表中的音频文件
5. **自动加载**: 抽屉关闭，显示加载进度条
6. **加载完成**: 该调变为绿色，显示绿点标记

#### 场景2：切换已加载的调
1. **点击按钮**: 点击已加载的调（绿色背景）
2. **直接切换**: 立即切换到该调，无需弹出抽屉

### 📁 音频文件配置

在 `getAvailableAudioFiles()` 函数中配置项目音频：

```typescript
const getAvailableAudioFiles = () => {
  const audioFiles = [
    { key: 'A', name: 'A 调 Blues 伴奏', url: '/blues-mp3/A.mp3', bpm: 125 },
    { key: 'C', name: 'C 调 Blues 伴奏', url: '/blues-mp3/C.mp3', bpm: 120 },
    { key: 'D', name: 'D 调 Blues 伴奏', url: '/blues-mp3/D.mp3', bpm: 120 },
    // ... 继续添加其他调
  ];
  return audioFiles;
};
```

### 🎨 抽屉UI特性

#### 视觉设计
- **背景遮罩**: 黑色半透明 + 毛玻璃效果
- **抽屉容器**: 从底部滑出，圆角顶部
- **渐变背景**: 灰色到黑色渐变
- **紫色边框**: 顶部紫色边框装饰

#### 头部区域
- **标题**: "🎵 选择 X 调音频"
- **关闭按钮**: 右上角 X 按钮
- **说明文字**: "从项目音频库中选择伴奏文件"

#### 列表区域
- **音频卡片**: 每个音频一个卡片
- **悬停效果**: 放大 + 边框高亮
- **显示信息**: 
  - 音频名称（大字体）
  - 原始 BPM
  - 文件路径
- **右箭头**: 表示可点击选择

#### 空状态
- **文件夹图标**: 📁 大图标
- **提示文字**: "暂无可用的音频文件"
- **引导说明**: "请在 public/blues-mp3 目录下添加 X.mp3 文件"

### 🔧 技术实现

#### 状态管理
```typescript
const [isDrawerOpen, setIsDrawerOpen] = useState(false);
const [selectedKeyForDrawer, setSelectedKeyForDrawer] = useState<BackingTrackKey>('A');
```

#### 动画效果
```typescript
// 抽屉从底部滑入
initial={{ y: '100%' }}
animate={{ y: 0 }}
exit={{ y: '100%' }}
transition={{ type: 'spring', damping: 25, stiffness: 300 }}
```

#### 点击逻辑
```typescript
onClick={() => {
  if (isPreloadedKey) {
    // 已加载：直接切换
    loadAudioBacking(key);
  } else {
    // 未加载：打开抽屉
    setSelectedKeyForDrawer(key);
    setIsDrawerOpen(true);
  }
}}
```

### 📝 使用示例

#### 添加新的音频文件

1. **放置文件**: 将音频文件放到 `public/blues-mp3/` 目录
   ```
   public/
   └── blues-mp3/
       ├── A.mp3  ✅ 已有
       ├── C.mp3  ← 新添加
       └── D.mp3  ← 新添加
   ```

2. **更新配置**: 在代码中添加配置
   ```typescript
   const audioFiles = [
     { key: 'A', name: 'A 调 Blues 伴奏', url: '/blues-mp3/A.mp3', bpm: 125 },
     { key: 'C', name: 'C 调 Blues 伴奏', url: '/blues-mp3/C.mp3', bpm: 120 },
     { key: 'D', name: 'D 调 Blues 伴奏', url: '/blues-mp3/D.mp3', bpm: 120 },
   ];
   ```

3. **使用**: 点击 C 调按钮 → 抽屉显示 C 调音频 → 点击选择 → 加载完成

### 🎯 优势

✅ **清晰的交互**: 点击即可选择，无需悬浮
✅ **视觉反馈**: 抽屉动画流畅，状态清晰
✅ **易于扩展**: 只需添加文件和配置即可
✅ **用户友好**: 显示详细的音频信息
✅ **响应式**: 适配不同屏幕尺寸

### 🆚 与之前的区别

| 特性 | 之前（悬浮菜单） | 现在（抽屉） |
|------|----------------|------------|
| 触发方式 | 鼠标悬停 | 点击按钮 |
| 选择方式 | 本地文件选择器 | 项目音频列表 |
| 显示位置 | 按钮下方小菜单 | 底部大抽屉 |
| 音频来源 | 用户本地 | 项目预置 |
| 交互体验 | 需要精确悬停 | 点击即可 |

---

**更新时间**: 2025-01-07  
**版本**: v3.0.0
